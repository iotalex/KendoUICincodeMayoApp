!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("kendo.core.js"),require("kendo.buttongroup.js"),require("kendo.icons.js"),require("kendo.toolbar.js")):"function"==typeof define&&define.amd?define(["kendo.core.min","kendo.buttongroup.min","kendo.icons.min","kendo.toolbar.min"],t):((e="undefined"!=typeof globalThis?globalThis:e||self).kendofilter=e.kendofilter||{},e.kendofilter.js=t())}(this,(function(){var e={number:0,boolean:!1,string:"",date:""},t=({ns:e,operators:t})=>({type:"component",element:`<div data-${e}bind="value: logic"></div>`,component:"FilterButtonGroup",componentOptions:{items:Object.keys(t||{}).map((e=>({value:e,text:t[e].text||t[e],attributes:{value:e}})))},attributes:{"data-bind":"value: logic",title:"logic"}}),o=({mainFilterLogicLabel:e,uid:t,addExpression:o,addGroup:i,close:r,ns:s,operators:l})=>`<div class='k-filter-toolbar'><div class='k-toolbar' aria-label='${e}' id='${t}'></div></div>`,i=({filterLogicLabel:e,addExpression:t,addGroup:o,close:i,ns:r,operators:s})=>`<li class='k-filter-item' role='treeitem'><div class='k-filter-toolbar'><div role='toolbar' aria-label='${e}' class='k-toolbar'></div></div></li>`,r=({filterExpressionLabel:e,uid:t})=>`<li class='k-filter-item' role='treeitem'><div class='k-filter-toolbar'><div role='group' aria-label='${e}' class='k-toolbar' id='${t}'></div></div></li>`;return function(s){var l=window.kendo,a=l.ui,n=l.guid,d=l.ns,p=l.keys,f=a.Widget,u=a.ButtonGroup,c=":kendoFocusable",m="change",b="tabindex",h=".kendoFilter",v="Is equal to",g="Is not equal to",k={number:function(e,{field:t}){s(`<input tabindex='-1' id='${n()}' type='text' aria-label='${t}' title='${t}' data-${d}role='numerictextbox' data-${d}bind='value: value'/>`).appendTo(e)},string:function(e,{field:t}){s(`<span class='k-textbox k-input k-input-md k-rounded-md k-input-solid'><input tabindex='-1' id='${n()}' type='text' aria-label='${t}' title='${t}' class='k-input-inner' data-${l.ns}bind='value: value'/></span>`).appendTo(e)},boolean:function(e,{field:t}){s(`<input tabindex='-1' id='${n()}' class='k-checkbox k-checkbox-md k-rounded-md' aria-label='${t}' data-${d}role='checkbox' data-${d}bind='checked: value' type='checkbox'>`).appendTo(e)},date:function(e,{field:t}){s(`<input tabindex='-1' id='${n()}' type='text' aria-label='${t}' title='${t}' data-${d}role='datepicker' data-${d}bind='value: value'/>`).appendTo(e)}},_=u.extend({init:function(e,t){u.fn.init.call(this,e,t)},options:{name:"FilterButtonGroup"},value:function(e){if(void 0===e)return this._value;this._value=e,u.fn._select.call(this,this.wrapper.find("[value='"+e+"']")),this.trigger(m)},_select:function(e){-1!==e&&this.value(s(e).attr("value"))}}),x=f.extend({init:function(e,t){var o,i=this;f.fn.init.call(i,e,t),i.element=s(e).addClass("k-filter"),i.dataSource=t.dataSource,i.operators=s.extend(i.options.operators,t.operators),i._getFieldsInfo(),i._modelChangeHandler=i._modelChange.bind(i),i._renderMain(),t.expression&&i._addExpressionTree(i.filterModel),i._renderApplyButton(),i.options.expressionPreview&&(i._previewContainer||(i._previewContainer=s('<div class="k-filter-preview"></div>').insertAfter(i.element.children().eq(0))),o=i._createPreview(i.filterModel.toJSON()),i._previewContainer.html(o)),i._attachEvents(),i.hasCustomOperators();var r=s(i.element).find(".k-filter-toolbar > .k-toolbar");r.attr(b,-1),r.find(c).attr(b,-1),r.eq(0).attr(b,0)},events:[m],options:{name:"Filter",dataSource:null,expression:null,applyButton:!1,fields:[],mainLogic:"and",messages:{and:"And",or:"Or",apply:"Apply",close:"Close",addExpression:"Add Expression",fields:"Fields",filterExpressionLabel:"filter expression",filterLogicLabel:"filter logic",filterAriaLabel:"filter component",mainFilterLogicLabel:"main filter logic",operators:"Operators",addGroup:"Add Group"},operators:{string:{eq:v,neq:g,startswith:"Starts with",contains:"Contains",doesnotcontain:"Does not contain",endswith:"Ends with",isnull:"Is null",isnotnull:"Is not null",isempty:"Is empty",isnotempty:"Is not empty",isnullorempty:"Has no value",isnotnullorempty:"Has value"},number:{eq:v,neq:g,gte:"Is greater than or equal to",gt:"Is greater than",lte:"Is less than or equal to",lt:"Is less than",isnull:"Is null",isnotnull:"Is not null"},date:{eq:v,neq:g,gte:"Is after or equal to",gt:"Is after",lte:"Is before or equal to",lt:"Is before",isnull:"Is null",isnotnull:"Is not null"},boolean:{eq:v,neq:g}}},applyFilter:function(){var e=this.filterModel.toJSON();this._hasCustomOperators&&this._mapOperators(e),this._hasFieldsFilter(e.filters||[])?(this._removeEmptyGroups(e.filters),this.dataSource.filter(e)):this.dataSource.filter({})},destroy:function(){this.element.off(h),l.destroy(this.element.find(".k-filter-group-main")),this._previewContainer=null,this._applyButton=null,this._modelChangeHandler=null,f.fn.destroy.call(this)},setOptions:function(e){l.deepExtend(this.options,e),this.destroy(),this.element.empty(),this.init(this.element,this.options)},getOptions:function(){var e=s.extend(!0,{},this.options);return delete e.dataSource,e.expression=this.filterModel.toJSON(),e},_addExpressionTree:function(e){if(e.filters)for(var t=this.element.find("[id="+e.uid+"]"),o=0;o<e.filters.length;o++)e.filters[o].logic?this._addGroup(t,e.filters[o]):this._addExpression(t,e.filters[o]),e.filters[o].filters&&this._addExpressionTree(e.filters[o])},_click:function(e){var t=this;e.preventDefault();var o=s(e.currentTarget),i=o.data("command");"x"==i?t._removeExpression(o.closest(".k-toolbar")):"expression"==i?t._addExpression(o.closest(".k-toolbar")):"group"==i?t._addGroup(o.closest(".k-toolbar")):"apply"==i&&t.applyFilter()},_keydown:function(e){var t=this,o=s(e.target),i=e.keyCode,r=o.closest(".k-toolbar"),l=o.is(".k-toolbar");if(i===p.UP&&l)e.preventDefault(),t._focusToolbar(r,"prev");else if(i==p.DOWN&&l)e.preventDefault(),t._focusToolbar(r,"next");else if(i==p.ESC)e.stopPropagation(),t._focusToolbar(r);else if(i==p.ENTER&&l){r.find(".k-toolbar-item").eq(0).attr(b,0).trigger("focus")}},_attachEvents:function(){var e=this,t=e._click.bind(e),o=e._keydown.bind(e);e.element.on("click"+h,"button.k-button",t).on("keydown"+h,".k-filter-toolbar > .k-toolbar, .k-filter-toolbar > .k-toolbar .k-toolbar-item",o)},_focusToolbar:function(e,t,o){var i=e,r=s(this.element).find(".k-filter-toolbar > .k-toolbar");if(r.attr(b,-1),r.find(c).attr(b,-1),"next"==t){let t=Math.min(r.length-1,o||r.index(e)+1);i=r.eq(t)}else if("prev"==t){let t=Math.max(0,o||r.index(e)-1);i=r.eq(t)}i.attr(b,0).trigger("focus")},_addExpression:function(e,t){var o,i=this,a=e.attr("id"),n=e.closest(".k-filter-toolbar").next("ul.k-filter-lines"),p=t?i._fields[t.field]:i._defaultField,f="";t?o=t:((o=w(i.filterModel,a)).filters||o.set("filters",[]),o=i._addNewModel(o.filters,p)),n.length||(n=s("<ul class='k-filter-lines' role='group'></ul>").appendTo(e.closest("li")));var u={fields:i._fields,operators:i.operators[p.type],close:i.options.messages.close,fieldsLabel:i.options.messages.fields,uid:o.uid,ns:l.ns,filterExpressionLabel:i.options.messages.filterExpressionLabel},c=(f=s(l.template(r)(u)).appendTo(n)).find(".k-toolbar").first(),m=p.operators&&p.operators[p.type]?p.operators[p.type]:this.operators[p.type];c.kendoToolBar({resizable:!1,items:[{type:"component",component:"DropDownList",element:`<select data-${d}bind="value: field" class='k-filter-dropdown' title='${i.options.messages.fields}' aria-label='${i.options.messages.fields}' data-auto-width='true'></select>`,attributes:{class:"k-filter-field"},componentOptions:{title:i.options.messages.fields,dataTextField:"text",dataValueField:"value",dataSource:Object.keys(i._fields||{}).map((e=>({value:i._fields[e].name,text:i._fields[e].label})))}},{type:"component",component:"DropDownList",element:`<select data-${d}bind="value: operator" aria-label='${i.options.messages.operators}' title='${i.options.messages.operators}'></select>`,attributes:{class:"k-filter-operator"},componentOptions:{title:i.options.messages.operators,dataTextField:"text",dataValueField:"value",dataSource:Object.keys(m||{}).map((e=>({value:e,text:m.text||m[e]})))}},{attributes:{class:"k-filter-value"},template:" "},{type:"button",icon:"x",fillMode:"flat",attributes:{"data-command":"x",title:u.close,"aria-label":u.close}}]}),i._addExpressionControls(f.find(".k-toolbar"),p,o),t||i._expressionChange()},_addExpressionControls:function(e,t,o){var i=e.find(".k-toolbar-item.k-filter-operator"),r=e.find(".k-toolbar-item.k-filter-value");r.addClass("k-toolbar-tool"),l.destroy(r),r.empty(),this._bindOperators(i,t),this._appendEditor(r,t),this._bindModel(e,o),this._showHideEditor(e,o),e.find(c).attr(b,-1)},_bindOperators:function(e,t){var o=t.operators&&t.operators[t.type]?t.operators[t.type]:this.operators[t.type],i=e.find("select[data-role=dropdownlist]").getKendoDropDownList();i&&i.setDataSource(Object.keys(o||{}).map((e=>({value:e,text:o.text||o[e]}))))},_appendEditor:function(e,t){l.isFunction(t.editor)?t.editor(e,s.extend(!0,{},{field:t.name})):s(l.template(t.editor)({ns:l.ns,field:t.name,id:l.guid()})).appendTo(e)},_addNewModel:function(e,t){var o,i,r=t.type,s=t.operators;return s||(s=this.options.operators),i=Object.keys(s[r])[0],e.push({field:t.name}),(o=e[e.length-1]).set("value",t.defaultValue),o.set("operator",i),o},_addGroup:function(e,t){var o=this,r=o.filterModel,a=e.attr("id"),n=e.closest(".k-filter-toolbar").next("ul.k-filter-lines");t?r=t:((r=w(r,a)).filters||r.set("filters",[]),r.filters.push({logic:o.options.mainLogic}),r=r.filters[r.filters.length-1]),n.length||(n=s("<ul class='k-filter-lines' role='group'></ul>").appendTo(e.closest("li")));var d={operators:{and:o.options.messages.and,or:o.options.messages.or},addExpression:o.options.messages.addExpression,addGroup:o.options.messages.addGroup,close:o.options.messages.close,ns:l.ns,filterLogicLabel:o.options.messages.filterLogicLabel},p=s(l.template(i)(d)).appendTo(n).find(".k-toolbar");o._initGroupToolBar(p,d),o._bindModel(p,r),t||o._expressionChange()},_bindModel:function(e,t){e.attr("id",t.uid),t.bind("change",this._modelChangeHandler),l.bind(e,t),e.parent().attr(l.attr("stop"),!0)},_createPreview:function(e){var t,o,i="",r=!1,s=this._hasFieldsFilter(e.filters||[]),a="";if(!e.filters||!e.filters.length||!s)return"";i+='<span class="k-filter-preview-bracket">(</span>';for(var n=0;n<e.filters.length;n++)(t=e.filters[n]).filters&&((a=this._createPreview(t))&&(r&&(i+='<span class="k-filter-preview-operator"> '+e.logic.toLocaleUpperCase()+" </span>"),r=!0),i+=a),t.field&&(o=this._fields[t.field],r&&(i+='<span class="k-filter-preview-operator"> '+e.logic.toLocaleUpperCase()+" </span>"),r=!0,i+='<span class="k-filter-preview-field">'+o.label+"</span>",i+='<span class="k-filter-preview-criteria"> '+this._getOperatorText(t.field,t.operator),t.operator.indexOf("is")<0?(i+=" </span>",i+="<span class='k-filter-preview-value'>'"+l.htmlEncode(o.previewFormat?l.toString(t.value,o.previewFormat):t.value)+"'</span>"):i+="</span>");return i+='<span class="k-filter-preview-bracket">)</span>'},_expressionChange:function(){var e=this,t=e.filterModel.toJSON(),o="";e.options.expressionPreview&&(o=e._createPreview(t),e._previewContainer.html(o)),e.trigger(m,{expression:t})},_getOperatorText:function(e,t){var o=this._fields[e].type,i=this._fields[e].operators;return i||(i=this.options.operators),i[o][t].text||i[o][t]},_addField:function(t,o){var i=this;t=s.extend(!0,{},{name:t.name||o,editor:t.editorTemplate||k[t.type||"string"],defaultValue:t.defaultValue||!1===t.defaultValue||0===t.defaultValue?t.defaultValue:e[t.type||"string"],type:t.type||"string",label:t.label||t.name||o,operators:t.operators,previewFormat:t.previewFormat}),i._fields[t.name]=t,i._defaultField||(i._defaultField=t)},_getFieldsInfo:function(){var e,t=this,o=t.options.fields.length?t.options.fields:(t.options.dataSource.options.schema.model||{}).fields;if(t._fields={},Array.isArray(o))for(var i=0;i<o.length;i++)e=o[i],t._addField(e);else for(var r in o)e=o[r],t._addField(e,r)},_hasFieldsFilter:function(e,t){t=!!t;for(var o=0;o<e.length;o++)if(e[o].filters&&(t=this._hasFieldsFilter(e[o].filters,t)),e[o].field)return!0;return t},_removeEmptyGroups:function(e){if(e)for(var t=e.length-1;t>=0;t--)e[t].logic&&!e[t].filters||e[t].filters&&!this._hasFieldsFilter(e[t].filters)?e.splice(t,1):e[t].filters&&this._removeEmptyGroups(e[t].filters)},_modelChange:function(e){var t=this,o=t.element.find("[id="+e.sender.uid+"]");if(t._showHideEditor(o,e.sender),"field"===e.field){var i=e.sender.field,r=e.sender.parent(),s=t._fields[i],l=t._addNewModel(r,s);e.sender.unbind("change",t._modelChangeHandler),r.remove(e.sender),t._addExpressionControls(o,s,l),t._expressionChange()}else"filters"!==e.field&&t._expressionChange()},_renderMain:function(){var e,t=this;s((e=t.options.messages.filterAriaLabel,`<ul class='k-filter-container' role='tree' aria-label='${e}'><li class='k-filter-group-main' role='treeitem'></li></ul>`)).appendTo(t.element),t.options.expression?t.filterModel=l.observable(t.options.expression):t.filterModel=l.observable({logic:t.options.mainLogic});var i={operators:{and:t.options.messages.and,or:t.options.messages.or},addExpression:t.options.messages.addExpression,addGroup:t.options.messages.addGroup,close:t.options.messages.close,uid:t.filterModel.uid,ns:l.ns,mainFilterLogicLabel:t.options.messages.mainFilterLogicLabel},r=s(l.template(o)(i));r.appendTo(t.element.find("li").first());var a=r.find(".k-toolbar").first();t._initGroupToolBar(a,i),t._bindModel(a,t.filterModel)},_initGroupToolBar:function(e,o){e.kendoToolBar({resizable:!1,items:[t(o),{type:"button",icon:"filter-add-expression",attributes:{"data-command":"expression",title:o.addExpression,"aria-label":o.addExpression}},{type:"button",icon:"filter-add-group",attributes:{"data-command":"group",title:o.addGroup,"aria-label":o.addGroup}},{type:"button",icon:"x",fillMode:"flat",attributes:{"data-command":"x",title:o.close,"aria-label":o.close}}]})},_removeExpression:function(e){var t,o,i=this,r=e.attr("id"),a=e.closest("li"),n=-1;if(a.hasClass("k-filter-group-main"))a=a.find(".k-filter-lines"),i.filterModel.filters&&(i.filterModel.filters.empty(),delete i.filterModel.filters);else{n=s(i.element).find(".k-filter-toolbar > .k-toolbar").index(e),t=(o=w(i.filterModel,r)).parent(),o.unbind("change",i._modelChangeHandler),t.remove(o),t.length||delete t.parent().filters,a.siblings().length||(a=a.parent())}l.destroy(a),a.remove(),i._expressionChange(),n>-1&&i._focusToolbar(e,"next",n)},_renderApplyButton:function(){var e=this;e.options.applyButton&&(e._applyButton||(e._applyButton=s(l.format('<button type="button" data-command="apply" aria-label="{0}" title="{0}" class="k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-filter-apply">{0}</button>',e.options.messages.apply)).appendTo(e.element)))},_showHideEditor:function(e,t){if(!t.logic){var o=t.operator,i=e.find(".k-toolbar-item.k-filter-value");"isnull"==o||"isnotnull"==o||"isempty"==o||"isnotempty"==o||"isnullorempty"==o||"isnotnullorempty"==o?i.hide():i.show()}},_mapOperators:function(e){var t=this;e.filters&&e.filters.forEach((function(e){if(e.filters)t._mapOperators(e);else{var o,i=t._fields[e.field],r=i.type;(o=i.operators&&i.operators[r][e.operator]?i.operators[r][e.operator]:t.operators[r][e.operator])&&(e.operator=o.handler||e.operator)}}))},hasCustomOperators:function(){var e=s.extend(!0,{},this.operators);for(var t in this._fields)e=s.extend(!0,{},e,this._fields[t].operators);this._hasCustomOperators=y(e)}});function y(e){for(var t in e){var o=e[t];if(o.handler&&"function"==typeof o.handler||"object"==typeof o&&null!==o&&y(o))return!0}return!1}function w(e,t){if(e.uid===t)return e;if(e.filters)for(var o=0;o<e.filters.length;o++){var i=w(e.filters[o],t);if(i)return i}}a.plugin(x),a.plugin(_)}(window.kendo.jQuery),kendo}));
//# sourceMappingURL=kendo.filter.min.js.map
